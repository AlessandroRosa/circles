function CIRCLESembeddingsGRANDMAPARABOLIC_PRESETS_INIT()
{
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "0.7056734968i+1.6168866453", "2", 1, [ -2.3, 2.3, 2.3, -2.3 ], "Indra's p. 319 - plate 1" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.3", "2+i", 1, [ -2.3, 2.3, 2.3, -2.3 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.5-0.8660254038i", "1.5+0.8660254038i", 1, [ -2.3, 2.3, 2.3, -2.3 ], "Indra's p. 334" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.5306639-0.850104047i", "1.5306639+0.850104047i", 1, [ -2.3, 2.3, 2.3, -2.3 ], "Indra's p. 298" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.55+0.866i", "1.55-0.866i", 1, [ -2.3, 2.3, 2.3, -2.3 ], "Indra's p. 330" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.658312-0.5i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 308" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.64213876-0.76658841i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 272" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.785-0.73852i", "3", 1 , [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 312" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.7846648-0.73852i", "3", 1 , [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 312" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.80785524-0.136998688i", "2", 1 , [ -1.15, 1.15, 1.15, -1.15 ] ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.823932-0.595342i", "2", 1 , [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 295" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.87+0.1i", "1.87-0.1i", 1, [ -2.2, 2.2, 2.2, -2.2 ], "Indra's p. 226" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.887+0.05i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 245 plate 3" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.889+0.05i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 246 plate 2" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.8964073+0.0487530i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 293 plate 2" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.90211303259032", "1.90211303259032", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 293 plate 2" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.90378+0.03958i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 293 plate 4" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.91+0.05i", "1.91-0.05i", 1, [ -2.15, 2.15, 2.15, -2.15 ], "Indra's p. 293 plate 3" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.91+0.05i", "1.91+0.05i", 1, [ -2.15, 2.15, 2.15, -2.15 ], "Indra's p. 235" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.91+0.05i", "2", 2, [ -1.15, 1.15, 1.15, -1.15 ] ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.91+0.05i", "3", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 238 plate 3" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.9134233+0.036288i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 293 plate 1" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.9247306-0.0449408i", "1.91+0.2i", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 293 plate 1" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.94+0.05i", "3", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 238 plate 2" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.95+0.02i", "3", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 244" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.955859+0.01128i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ] ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.965557377-0.9953573493i", "3", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 264" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "1.97+0.05i", "3", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 238 plate 1" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 231 plate 6 - Classic Apollonian packing" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2", "3", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 245 plate 1" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2+0.05i", "2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 246 plate 1" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2+0.05i", "3", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 237 plate 3" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2+0.1i", "3", 2, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 236" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2+0.5i", "3", 2, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 234 plate 2" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2+0.2i", "2-0.2i", 1, [ -1.5, 1.5, 1.5, -1.5 ], "Indra's p. 234 plate 4" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2+0.5i", "2+0.5i", 1, [ -1.8, 1.8, 1.8, -1.8 ], "Indra's p. 234 plate 3" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2.2", "2.2", 1, [ -1.15, 1.15, 1.15, -1.15 ], "Indra's p. 231 plate 5" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2.2+0.05i", "3", 2, [ -1.5, 1.5, 1.5, -1.5 ], "Indra's p. 237 plate 2" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "3", "2", 1, [ -1.5, 1.5, 1.5, -1.5 ], "Indra's p. 245 plate 2" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "3.0-0.5i", "3.0+0.5i", 1, [ -1.5, 1.5, 1.5, -1.5 ], "Indra's p. 234 plate 1" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/10)", "2*cos(PI/10)", 1, [ -1.5, 1.5, 1.5, -1.5 ], "Indra's p. 241" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/3)", "2*cos(PI/(3+2i))", 1, [ -1.5, 1.5, 1.5, -1.5 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/3)", "2*cos(PI/(6+2i))", 1, [ -1.5, 1.5, 1.5, -1.5 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/5)", "2*cos(PI/(5+2i))", 1, [ -1.5, 1.5, 1.5, -1.5 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/8)", "2*cos(PI/(8+i))", 1, [ -1.5, 1.5, 1.5, -1.5 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/(256i))", "2*cos(PI/(7+1.8i))", 2, [ -1.6, 1.6, 1.6, -1.6 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/(256i))", "2*cos(PI/(8+1.8i))", 1, [ -3.6, 3.6, 3.6, -3.6 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/(256i))", "2*cos(PI/(8+i))", 1, [ -1.6, 1.6, 1.6, -1.6 ], "Close to parabolics" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/(256i))", "2*cos(PI/(8+2i))", 1, [ -1.6, 1.6, 1.6, -1.6 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/(256i))", "2*cos(PI/(8+4i))", 1, [ -1.6, 1.6, 1.6, -1.6 ], "Chubby limit set" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI/(16-4i))", "2*cos(PI/(16+4i))", 1, [ -1.6, 1.6, 1.6, -1.6 ], "" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI*PI/(16-4i))", "2*cos(PI/(16+4i))", 1, [ -1.6, 1.6, 1.6, -1.6 ], "Chtulhu" ] );
    CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray.push( [ "2*cos(PI*PI/(16-4i))", "2*cos(PI*PI/(16+4i))", 1, [ -1.6, 1.6, 1.6, -1.6 ], "Nasty fog" ] );
}

function CIRCLESembeddingsGRANDMAPARABOLIC_PRESETS( _opcode, _init )
{
    _opcode = safe_float( _opcode, UNDET ), _init = safe_int( _init, NO );
    switch( _opcode )
    {
        case 1: // display
        var _html = "<SELECT ID=\"PLUGINpresetsCOMBO\" ONCHANGE=\"javascript:CIRCLESembeddingsGRANDMAPARABOLIC_PRESETS(2,YES);\">" ;
            _html += "<OPTION VALUE=\""+UNDET+"\" SELECTED=\"selected\">" ;
            $.each( CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray, function( _i, _v ) { _html += "<OPTION VALUE=\""+_i+"\">#" + ( _i + 1 ) + ( _v[4] != null ? " - " + _v[4] : "" ) } );
            _html += "</SELECT>" ;
        return _html ;
        break ;
        case 2: // select
        var _index = $( "#PLUGINpresetsCOMBO" ).val();
        var _chunk = CIRCLESembeddingsGRANDMAPARABOLIC_PRESETSarray[_index] ;
        if ( _chunk != null )
        {
            $( "#PLUGIN_PARAM_A" ).val( _chunk[0] );
            $( "#PLUGIN_PARAM_B" ).val( _chunk[1] );
            var _comp = Math.max( 1, Math.abs( safe_int( _chunk[2], 1 ) ) );
            var _coords = _chunk[3] ;
            
            if ( is_array( _coords ) && safe_size( _coords, 0 ) == 4 && _glob_interface_index == INTERFACE_EXTEND_NONE )
            {
               var _ret_chunk = circles_lib_canvas_coords_correct_aspectratio( W_PLANE );
               if ( _ret_chunk[0] != RET_IRRELEVANT ) circles_lib_canvas_layer_pile_resize_to_default();
            }
            else
            {
               _coords = circles_lib_interface_recalc_bounding_coords( INTERFACE_INPUT_HEIGHT,
                                                    _glob_wplaneLEFT, safe_float( _coords[1], DEFAULT_PLANE_COORD ),
                                                    _glob_wplaneRIGHT, safe_float( _coords[3], -DEFAULT_PLANE_COORD )
                                                   ) ;
            }

            _glob_zplaneLEFT = _glob_wplaneLEFT = _glob_bipLEFT = safe_float( _coords[0], -DEFAULT_PLANE_COORD );
            _glob_zplaneTOP = _glob_wplaneTOP = _glob_bipTOP = safe_float( _coords[1], DEFAULT_PLANE_COORD );
            _glob_zplaneRIGHT = _glob_wplaneRIGHT = _glob_bipRIGHT = safe_float( _coords[2], DEFAULT_PLANE_COORD );
            _glob_zplaneBOTTOM = _glob_wplaneBOTTOM = _glob_bipBOTTOM = safe_float( _coords[3], -DEFAULT_PLANE_COORD );
            circles_lib_canvas_coords_acquire( ALL_PLANES );

            CIRCLESembeddingsGRANDMAPARABOLIC_INIT(NO,YES);
					  CIRCLESembeddingsGRANDMAPARABOLIC_COMP( _comp, _init );
            CIRCLESembeddingsGRANDMAPARABOLIC_CONFIG();
            GLOB_PLUGIN_WIZARD_STEP(0.1,NO);
            GLOB_PLUGIN_WIZARD_STEP(1.1,YES);
            $( "#PLUGIN_GENSTOGGLE_BTN" ).html( "Hide panel" );
				    circles_lib_output( OUTPUT_SPECIAL_FX, DISPATCH_SUCCESS, "Group has been init with success", 'PLUGIN_OUTMSG') ;

            if( $( "#CIRCLESembeddingsGRANDMAPARABOLIC_CANVAS" ).is( ":visible" ) )
            {
                var _fn_str = "circles_lib_plugin_render_preview", _fn = null ;
                try{ eval( "_fn = " + _fn_str ) ; } catch( _err ){ circles_lib_error_obj_handler( _err ); }
                if ( typeof _fn === "function" ) _fn.call( this, "grandma.parabolic", "embeddings", Z_PLANE ) ;
            }
            _glob_target_plane = W_PLANE ;
        }
        return null ;
        break ;
        default: break ;
    }

    return null ;
}

function CIRCLESembeddingsGRANDMAPARABOLIC_COMP( _param, _init )
{
		_init = safe_int( _init, YES );
    _param = Math.min( Math.max( safe_int( _param, 1 ), 1 ), 2 ) ;
    CIRCLESembeddingsGRANDMAPARABOLIC_param = _param ;
    var _index_ref = _plugin_last_ref;
    var trA = CIRCLESembeddingsGRANDMAPARABOLIC_trA_complex, trB = CIRCLESembeddingsGRANDMAPARABOLIC_trB_complex ;
    if ( CIRCLESembeddingsGRANDMAPARABOLIC_param == UNDET ) circles_lib_output( OUTPUT_SPECIAL_FX, DISPATCH_WARNING, "Missing input solution index.", 'PLUGIN_OUTMSG' ) ;
    else if ( !is_complex( trA ) || !is_complex( trB ) ) circles_lib_output( OUTPUT_SPECIAL_FX, DISPATCH_ERROR, "The input trace is not a complex formula.", 'PLUGIN_OUTMSG') ;
    else
    {
		    if ( is_array( _glob_seeds_array ) ) _glob_seeds_array.flush();
		    if ( is_array( _glob_seeds_array ) ) _glob_seeds_array.flush();

        $('#PLUGIN1stSOLUTIONid').css('font-weight',CIRCLESembeddingsGRANDMAPARABOLIC_param==1?'bold':'');
        $('#PLUGIN2ndSOLUTIONid').css('font-weight',CIRCLESembeddingsGRANDMAPARABOLIC_param==2?'bold':'');
        var trAB = CIRCLESembeddingsGRANDMAPARABOLIC_param == 1 ? CIRCLESembeddingsGRANDMAPARABOLIC_trAB_1 : CIRCLESembeddingsGRANDMAPARABOLIC_trAB_2 ;
        
        var z0_num = ( trAB.sub( 2.0 ) ).mul( trB );
        var z0_den = ( ( trB.mul( trAB ) ).sub( trA.mul( 2.0 ) ) ).add( trAB.mul( new complex( 0.0, 2.0 ) ) );
        var z0 = ( z0_num ).div( z0_den );

        var MM_01_a = trA.div( 2.0 );

        var num_b = ( ( trA.mul( trAB ) ).sub( trB.mul( 2.0 ) ) ).add( new complex( 0.0, 4.0 ) );
        var den_b = ( trAB.mul( 2.0 ).add( 4.0 ) ).mul( z0 );
        var MM_01_b = num_b.div( den_b );

        var num_c = ( ( trA.mul( trAB ).sub( trB.mul( 2.0 ) ) ).sub( new complex( 0.0, 4.0 ) ) ).mul(z0);
        var den_c = ( trAB.mul( 2.0 ) ).sub( 4.0 );
        var MM_01_c = num_c.div( den_c );

        var MM_01_d = MM_01_a ;

        var MM_02_a = ( trB.sub( new complex( 0.0, 2.0 ) ) ).div( 2.0 );
        var MM_02_b = trB.div( 2.0 );
        var MM_02_c = MM_02_b ;
        var MM_02_d = ( trB.add( new complex( 0.0, 2.0 ) ) ).div( 2.0 );

        var MM_01 = new mobius_map( MM_01_a, MM_01_b, MM_01_c, MM_01_d );
        var MM_02 = new mobius_map( MM_02_a, MM_02_b, MM_02_c, MM_02_d );

        CIRCLESembeddingsGRANDMAPARABOLIC_mm_01 = MM_01 ;
        CIRCLESembeddingsGRANDMAPARABOLIC_mm_02 = MM_02 ;
        CIRCLESembeddingsGRANDMAPARABOLIC_OUTPUT( MM_01, MM_02, trAB, z0, _init );

        $("#PLUGINsetBTN").attr('class', 'linkdead');
        CIRCLESembeddingsGRANDMAPARABOLIC_active = _glob_dict_create = _glob_items_to_init = YES ;
        $('[id$=initBTN]').css('color',COLOR_ERROR) ;
    }
}

function CIRCLESembeddingsGRANDMAPARABOLIC_OUTPUT( MM_01, MM_02, trAB, z0, _init )
{
		_init = safe_int( _init, YES );
    var _mm01_trace_squared = MM_01.trace().pow( 2.0 ).radius();
    var _mm02_trace_squared = MM_02.trace().pow( 2.0 ).radius();
    var inverse_MM_01 = MM_01.inv(), inverse_MM_02 = MM_02.inv();

    GLOB_PLUGIN_CIRCLE_TYPE = $( "#PLUGINcircleCOMBO option:selected" ).val();
    if ( GLOB_PLUGIN_CIRCLE_TYPE == 0 ) GLOB_PLUGIN_CIRCLE_TYPE = DRAWENTITY_ISOMETRIC_CIRCLE ;

    var _CC_01 = MM_01.inversion_circle();
    var _IS_01 = MM_01.isometric_circle();
    var _circle01 = GLOB_PLUGIN_CIRCLE_TYPE == DRAWENTITY_ISOMETRIC_CIRCLE ? _IS_01 : _CC_01 ;

    var _CC_02 = MM_02.inversion_circle();
    var _IS_02 = MM_02.isometric_circle();
    var _circle02 = GLOB_PLUGIN_CIRCLE_TYPE == DRAWENTITY_ISOMETRIC_CIRCLE ? _IS_02 : _CC_02 ;

    var _INV_CC_01 = inverse_MM_01.inversion_circle();
    var _INV_IS_01 = inverse_MM_01.isometric_circle();
    var _inv_circle01 = GLOB_PLUGIN_CIRCLE_TYPE == DRAWENTITY_ISOMETRIC_CIRCLE ? _INV_IS_01 : _INV_CC_01 ;

    var _INV_CC_02 = inverse_MM_02.inversion_circle();
    var _INV_IS_02 = inverse_MM_02.isometric_circle();
    var _inv_circle02 = GLOB_PLUGIN_CIRCLE_TYPE == DRAWENTITY_ISOMETRIC_CIRCLE ? _INV_IS_02 : _INV_CC_02 ;

    var screen_CC_01 = circles_lib_complex_to_screen_disk( _circle01, zplane_sm, circles_lib_alphabet_get_color_from_symbol('a') );
    var screen_CC_02 = circles_lib_complex_to_screen_disk( _circle02, zplane_sm, circles_lib_alphabet_get_color_from_symbol('b') );
    var screen_INV_CC_01 = circles_lib_complex_to_screen_disk( _inv_circle01, zplane_sm, circles_lib_alphabet_get_color_from_symbol('A') );
    var screen_INV_CC_02 = circles_lib_complex_to_screen_disk( _inv_circle02, zplane_sm, circles_lib_alphabet_get_color_from_symbol('B') );

    _glob_seeds_array = [];
    _glob_seeds_array.push( new item_obj( MM_01, _circle01, screen_CC_01, "a", 0, YES, screen_CC_01.drawcolor, NO, screen_CC_01.drawcolor, "A", 1, ITEM_TYPE_CIRCLE ) );
    _glob_seeds_array.push( new item_obj( MM_02, _circle02, screen_CC_02, "b", 0, YES, screen_CC_02.drawcolor, NO, screen_CC_02.drawcolor, "B", 1, ITEM_TYPE_CIRCLE ) );
    _glob_seeds_array.push( new item_obj( inverse_MM_01, _inv_circle01, screen_INV_CC_01, "A", 0, YES, screen_INV_CC_01.drawcolor, NO, screen_INV_CC_01.drawcolor, "a", 1, ITEM_TYPE_CIRCLE ) );
    _glob_seeds_array.push( new item_obj( inverse_MM_02, _inv_circle02, screen_INV_CC_02, "B", 0, YES, screen_INV_CC_02.drawcolor, NO, screen_INV_CC_02.drawcolor, "b", 1, ITEM_TYPE_CIRCLE ) );

 		_glob_dict_create = _glob_items_to_init = YES ;
    var _index_ref = _plugin_last_ref;
    GLOB_PLUGIN_APPLY_SETTINGS(_index_ref) ;
    _glob_items_to_init = YES ;
    circles_lib_items_switch_to( ITEMS_SWITCH_SEEDS, YES, _glob_output_channel );
    if ( _init )
    {
        var _ret_chunk = circles_lib_items_init( null, NO, YES, _glob_init_mask, NO, NO, _glob_output_channel );
        var _ret_id = is_array( _ret_chunk ) ? _ret_chunk[0] : RET_ERROR ;
        var _ret_msg = is_array( _ret_chunk ) ? _ret_chunk[1] : "61Unknown error" ;
        if ( _ret_id == RET_OK )
        {
            $('[id$=initBTN]').css('color',DEFAULT_COLOR_STD);
            $("#PLUGIN_CONTAINER_PARAMS").html( GLOB_PLUGIN_GENS_TABLE_SHOW('grandma.parabolic') );
            
        }
        else
        {
            $('[id$=initBTN]').css('color',COLOR_ERROR);
            circles_lib_log_add_entry( _ret_msg, LOG_WARNING );
        }
    }
}

function CIRCLESembeddingsGRANDMAPARABOLIC_CALC( trA, trB, _set_globals )
{
    _set_globals = safe_int( _set_globals, NO );
  	var _index_ref = _plugin_last_ref + "";
    // x^2-(trA * trB)x+(t_a^2+t_b^2)=0
    var k = ( trA.mul( trB ) ).opposite();
    var j = ( trA.mul( trA ) ).add( trB.mul( trB ) );
    // so that it turns into : x^2 + kx + j = 0
    var _delta = ( k.pow(2) ).sub( j.mul( 4.0 ) );
    var _trAB_1 = ( k.opposite().add( _delta.sqrt() ) ).div( 2.0 );
    var _trAB_2 = ( k.opposite().sub( _delta.sqrt() ) ).div( 2.0 );
    if ( _set_globals )
    {
        CIRCLESembeddingsGRANDMAPARABOLIC_trAB_1 = _trAB_1 ;
        CIRCLESembeddingsGRANDMAPARABOLIC_trAB_2 = _trAB_2 ;
    }

    return [ _trAB_1, _trAB_2 ] ;
}

function CIRCLESembeddingsGRANDMAPARABOLIC_INIT( _skip_edit_acquisition, _calc )
{
  	var _index_ref = _plugin_last_ref + "";
    var trA_formula, trB_formula ;
    _skip_edit_acquisition = safe_int( _skip_edit_acquisition, NO ), _calc = safe_int( _calc, NO );
    _glob_init_mask = INIT_FROM_MAPS | INIT_PAIRED_ITEMS ;
    if ( !_skip_edit_acquisition )
    {
        trA_formula = $("#PLUGIN_PARAM_A").val().length > 0 ? $("#PLUGIN_PARAM_A").val() : CIRCLESembeddingsGRANDMAPARABOLIC_trA ;
        trB_formula = $("#PLUGIN_PARAM_B").val().length > 0 ? $("#PLUGIN_PARAM_B").val() : CIRCLESembeddingsGRANDMAPARABOLIC_trB ;
        CIRCLESembeddingsGRANDMAPARABOLIC_PARSE( trA_formula, trB_formula );
    }
    else
    {
        CIRCLESembeddingsGRANDMAPARABOLIC_trA = _plugin_tmp_vars_array['a'] ;
        CIRCLESembeddingsGRANDMAPARABOLIC_trB = _plugin_tmp_vars_array['b'] ;
        CIRCLESembeddingsGRANDMAPARABOLIC_param = safe_int( _plugin_tmp_vars_array['p'], 1 );
        CIRCLESembeddingsGRANDMAPARABOLIC_PARSE( CIRCLESembeddingsGRANDMAPARABOLIC_trA, CIRCLESembeddingsGRANDMAPARABOLIC_trB );
    }

    if ( !is_complex( CIRCLESembeddingsGRANDMAPARABOLIC_trA_complex ) || !is_complex( CIRCLESembeddingsGRANDMAPARABOLIC_trB_complex ) )
    circles_lib_output( OUTPUT_SPECIAL_FX, DISPATCH_ERROR, "At least one of the two traces is not a complex formula.", 'PLUGIN_OUTMSG' ) ;
    else
		{
        var BOLD = "" ;
        if ( _calc ) CIRCLESembeddingsGRANDMAPARABOLIC_CALC( CIRCLESembeddingsGRANDMAPARABOLIC_trA_complex, CIRCLESembeddingsGRANDMAPARABOLIC_trB_complex, YES );
        if ( is_complex( CIRCLESembeddingsGRANDMAPARABOLIC_trAB_1 ) || is_complex( CIRCLESembeddingsGRANDMAPARABOLIC_trAB_2 ) )
        {
            var HTMLcode = "<table WIDTH=\"100%\">" ;
                HTMLcode += "<tr>" ;
                HTMLcode += "<td VALIGN=\"top\" CLASS=\"general_rounded_corners\" STYLE=\"padding:4px;background-color:#F3F3F3;\">" ;
                HTMLcode += "<table WIDTH=\"100%\">" ;

            if ( is_complex( CIRCLESembeddingsGRANDMAPARABOLIC_trAB_1 ) )
            {
                _BOLD = CIRCLESembeddingsGRANDMAPARABOLIC_param == 1 ? "font-weight:bold;" : "" ;
                HTMLcode += "<tr><td HEIGHT=\"4\"></td></tr>" ;
                HTMLcode += "<tr><td WIDTH=\"3\"></td><td COLSPAN=\"3\">1st solution - Tr<sub>ab</sub> : "+CIRCLESembeddingsGRANDMAPARABOLIC_trAB_1.roundTo(PLUGINapproxPLACES).formula()+"</td><td WIDTH=\"5\"></td>" ;
                HTMLcode += "    <td CLASS=\"link_rounded\" STYLE=\"width:45px;"+_BOLD+"\" ID=\"PLUGIN1stSOLUTIONid\" ONCLICK=\"javascript:$('#PLUGIN2ndSOLUTIONid').css('font-weight','');$(this).css('font-weight','bold');CIRCLESembeddingsGRANDMAPARABOLIC_COMP(1);CIRCLESembeddingsGRANDMAPARABOLIC_CONFIG();GLOB_PLUGIN_WIZARD_STEP(1.1,YES);CIRCLESembeddingsGRANDMAPARABOLIC_RECORD_PARAMS();\">Apply</td></tr>" ;
            }
            else HTMLcode += "<tr><td COLSPAN=\"3\" STYLE=\"color:"+DEFAULT_COLOR_ERROR+";\">Tr<sub>ab</sub> (1st solution) : invalid output value</td></tr>" ;

            if ( is_complex( CIRCLESembeddingsGRANDMAPARABOLIC_trAB_2 ) )
            {
                _BOLD = CIRCLESembeddingsGRANDMAPARABOLIC_param == 2 ? "font-weight:bold;" : "" ;
                HTMLcode += "<tr><td HEIGHT=\"2\"></td></tr>" ;
                HTMLcode += "<tr><td WIDTH=\"3\"></td><td COLSPAN=\"3\">2nd solution - Tr<sub>ab</sub> : "+CIRCLESembeddingsGRANDMAPARABOLIC_trAB_2.roundTo(PLUGINapproxPLACES).formula()+"</td><td WIDTH=\"5\"></td>" ;
                HTMLcode += "    <td CLASS=\"link_rounded\" STYLE=\"width:45px;"+_BOLD+"\" ID=\"PLUGIN2ndSOLUTIONid\" ONCLICK=\"javascript:$('#PLUGIN1stSOLUTIONid').css('font-weight','');$(this).css('font-weight','bold');CIRCLESembeddingsGRANDMAPARABOLIC_COMP(2);CIRCLESembeddingsGRANDMAPARABOLIC_CONFIG();GLOB_PLUGIN_WIZARD_STEP(1.1,YES);CIRCLESembeddingsGRANDMAPARABOLIC_RECORD_PARAMS();\">Apply</td></tr>" ;
            }
            else HTMLcode += "<tr><td COLSPAN=\"3\" STYLE=\"color:"+DEFAULT_COLOR_ERROR+";\">Tr<sub>ab</sub> (2nd solution) : invalid output value</td></tr>" ;

            HTMLcode += "</table>" ;
            HTMLcode += "</td>" ;
            HTMLcode += "</tr>" ;
            HTMLcode += "<tr><td HEIGHT=\"3\"></td></tr>" ;
            HTMLcode += "<tr><td VALIGN=\"top\" ID=\"PLUGIN_CONTAINER_PARAMS\"></td></tr>" ;
            HTMLcode += "<tr><td HEIGHT=\"3\"></td></tr>" ;
            HTMLcode += "</table>" ;

            if ( CIRCLESembeddingsGRANDMAPARABOLIC_form_flag == 0 )
            {
								$("#PLUGIN_CONTAINER").html( HTMLcode );
				        $("#PLUGIN_CONTAINER").show( "slow", function() { circles_lib_forms_adjust_position( GLOB_PLUGIN_DIV_ID ) ; } );
						}
        }
    }
}

function CIRCLESembeddingsGRANDMAPARABOLIC_PARSE( _tr_a_formula, _tr_b_formula )
{
    var _entries = $( "[id^=PLUGIN_PARAM_]" );
    $.each( _entries, function( _i, _id ) { $( _id ).val( $( _id ).val().replaceAll( ",", "." ) ); } );

  	var _index_ref = _plugin_last_ref + "";
    _tr_a_formula = safe_string( _tr_a_formula, "0" );
    _tr_b_formula = safe_string( _tr_b_formula, "0" );

    _tr_a_formula = circles_lib_parse_fix_formula( _tr_a_formula );
    _tr_b_formula = circles_lib_parse_fix_formula( _tr_b_formula );

    if ( $("#PLUGIN_PARAM_A").get(0) != null ) $("#PLUGIN_PARAM_A").val( _tr_a_formula );
    if ( $("#PLUGIN_PARAM_B").get(0) != null ) $("#PLUGIN_PARAM_B").val( _tr_b_formula );

    CIRCLESembeddingsGRANDMAPARABOLIC_trA = _tr_a_formula, CIRCLESembeddingsGRANDMAPARABOLIC_trB = _tr_b_formula ;
    CIRCLESembeddingsGRANDMAPARABOLIC_trA_complex = circles_lib_math_parse_formula( CIRCLESembeddingsGRANDMAPARABOLIC_trA + "" );
    CIRCLESembeddingsGRANDMAPARABOLIC_trB_complex = circles_lib_math_parse_formula( CIRCLESembeddingsGRANDMAPARABOLIC_trB + "" );

    CIRCLESembeddingsGRANDMAPARABOLIC_trA_complex = parse_complex_from_string( CIRCLESembeddingsGRANDMAPARABOLIC_trA_complex + "" );
    CIRCLESembeddingsGRANDMAPARABOLIC_trB_complex = parse_complex_from_string( CIRCLESembeddingsGRANDMAPARABOLIC_trB_complex + "" );

    if ( _plugin_tmp_vars_array['embeddings@grandmaparabolic'] == null ) _plugin_tmp_vars_array['embeddings@grandmaparabolic'] = [] ;
    _plugin_tmp_vars_array['embeddings@grandmaparabolic']['a'] = CIRCLESembeddingsGRANDMAPARABOLIC_trA ;
    _plugin_tmp_vars_array['embeddings@grandmaparabolic']['b'] = CIRCLESembeddingsGRANDMAPARABOLIC_trB ;
    _plugin_tmp_vars_array['embeddings@grandmaparabolic']['p'] = CIRCLESembeddingsGRANDMAPARABOLIC_param ;

    _plugin_tmp_vars_array['a'] = CIRCLESembeddingsGRANDMAPARABOLIC_trA ;
    _plugin_tmp_vars_array['b'] = CIRCLESembeddingsGRANDMAPARABOLIC_trB ;
    _plugin_tmp_vars_array['p'] = CIRCLESembeddingsGRANDMAPARABOLIC_param ;

    if ( _plugin_vars_array[_index_ref]['a']['value'] != null ) _plugin_vars_array[_index_ref]['a']['value'] = CIRCLESembeddingsGRANDMAPARABOLIC_trA_complex ;
    if ( _plugin_vars_array[_index_ref]['b']['value'] != null ) _plugin_vars_array[_index_ref]['b']['value'] = CIRCLESembeddingsGRANDMAPARABOLIC_trB_complex ;
    if ( _plugin_vars_array[_index_ref]['p']['value'] != null ) _plugin_vars_array[_index_ref]['p']['value'] = CIRCLESembeddingsGRANDMAPARABOLIC_param ;

    GLOB_PLUGIN_VARS_PATTERN_SAVE(_index_ref);
}